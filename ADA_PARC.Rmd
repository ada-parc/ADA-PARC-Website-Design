---
title: "ADA-PARC"
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    theme: yeti
    includes:
      in_header: www/cssloaders.html
    css: www/styles.css
runtime: shiny
resource_files:
- www/participant_logos.png
- scripts/functions.R
- data/dict_vars.csv
- data/final/city_place_full.Rds
- data/final/dict_location_crosswalk.Rds
- data/final/tract_data.Rds
- data/final/tracts_sf.Rds
- data/final/national_data.Rds
- data/final/tracts_data.Rds
- www/Status_for_Disabled_image.png
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}

### ----- Packages ----- 

library(tidyverse)
library(patchwork)
library(sf)
library(leaflet)
library(leaflet.extras)
library(htmltools)
library(shiny)
library(shinycssloaders)
library(shinyWidgets)
library(flexdashboard)
library(colourpicker)
library(scales)
library(tableHTML)
library(hrbrthemes)
library(ggthemes)
library(extrafont)
library(sf)
library(tigris)
library(RColorBrewer)
library(cowplot)
library(readxl)
library(kableExtra)
library(shinythemes)


options(scipen = 999999,
        tigris_use_cache = TRUE,
        shiny.reactlog = TRUE)
knitr::opts_chunk$set(fig.cap = TRUE)

#################################
#################################
# Load data:
#################################
#################################
city_place_full <- readRDS(here::here("data", "final", "city_place_full.Rds")) 

dict_location_crosswalk <- readRDS(here::here("data", "final", "dict_location_crosswalk.Rds")) 
tracts_data <- readRDS(here::here("data", "final", "tracts_data.Rds")) 

national_data <- readRDS(here::here("data", "final", "national_data.Rds")) 

tracts_sf <- readRDS(here::here("data", "final", "tracts_sf.Rds"))


# Read in variable dictionary manually
dict_vars <- read_csv(here::here("data", "dict_vars.csv"))

east_coast_states_to_relocate <- c("RI", "DE", "DC", "MD")

us_states <- states(cb = TRUE, resolution = "20m") %>%
  shift_geometry() %>%
  sf::st_cast("MULTIPOLYGON") %>% 
  select(GEOID, ABBR = STUSPS, NAME, geometry)

us_states <- us_states %>% 
  left_join(
    us_states %>%
      sf::st_drop_geometry() %>%
      bind_cols(
        us_states %>%
          sf::st_centroid() %>%
          sf::st_coordinates() %>% 
          as_tibble()
      )
  ) %>% 
  mutate(
    x_lab = case_when(
      ABBR %in% east_coast_states_to_relocate ~ 2300000,
      ABBR == "FL" ~ X + 80000,
      ABBR == "LA" ~ X - 60000,
      .default = X
    ),
    y_lab = case_when(
      ABBR == "DC" ~ Y - 180000,
      ABBR == "DE" ~ Y + 100000,
      ABBR == "NH" ~ Y - 40000,
      ABBR == "VT" ~ Y + 40000,
      ABBR == "MD" ~ Y - 40000,
      ABBR == "LA" ~ Y + 40000,
      .default = Y
    )
  ) %>% 
  left_join(national_data)

### ----- Functions import -----

source(here::here("scripts", "functions.R"), local = TRUE)

```

# Home

```{r home}
ui <- fluidPage(
  theme = shinytheme("yeti"),
  tags$head(
    tags$style(HTML("
      body, html {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow-x: hidden; /* Prevents horizontal overflow */
        overflow-y: scroll;
      }
      .main-content {
        padding: 20px;
        box-sizing: border-box;
        width: 100%;
        height: 100%;
      }
      .welcome-text {
        font-size: 20px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
        margin-top: 10px;
      }
      .section-title {
        font-size: 20px; /* Increased font size for better emphasis */
        font-weight: bold;
        color: #2c3e50;
        margin-top: 25px; /* Added more margin to separate from previous section */
        margin-bottom: 10px; /* Increased margin for better spacing */
      }
      .section-content {
        font-size: 14px;
        color: #2c3e50;
        line-height: 1.4;
        margin-bottom: 10px;
      }
      .list-content {
        font-size: 16px; /* Increased font size for better readability */
        color: #2c3e50;
        line-height: 1.6; /* Increased line height for better spacing */
        margin-left: 25px; /* Adjusted margin for better alignment */
        margin-bottom: 10px; /* Added bottom margin to space out list items */
      }
      .footer {
        font-size: 12px;
        color: #2c3e50;
        padding: 10px;
        text-align: center;
        border-top: 1px solid #ddd;
      }
      img {
        display: block;
        max-width: 100%;
        height: auto;
        margin: 10px 0;
      }
      .email-button {
        display: inline-block;
        padding: 10px 15px;
        font-size: 14px;
        font-weight: bold;
        color: white;
        background-color: #2c3e50;
        border-radius: 5px;
        text-align: center;
        text-decoration: none;
        margin-top: 10px;
        margin-bottom: 10px;
      }
      .email-button:hover {
        background-color: #34495e;
        text-decoration: none;
      }
      .demographic-header {
        font-size: 22px;
        font-weight: bold;
        color: #2c3e50;
        margin-top: 30px;
        margin-bottom: 15px;
        text-align: left; /* Align the header to the left */
      }
    "))
  ),
  div(class = "main-content",
      div(class = "welcome-text", "Welcome to ADA-PARC!"),
      div(class = "section-title", "What is the ADA?"),
      div(class = "section-content", "The Americans with Disabilities Act (ADA), established in 1990, is a landmark civil rights law that prohibits discrimination against individuals with disabilities in all areas of public life."),
      
      div(class = "section-title", "How to Navigate this Website"),  # Adjusted section title
      tags$ul(
        class = "list-content",
        tags$li("National Data: examine the status of people with disabilities at the national and state level."),
        tags$li("City Data: investigate people with disabilities statistics at the municipal level."),
        tags$li("Scorecard: view our state by state report cards for each category."),
        tags$li("About: learn more about the ADA-PARC project."),
        tags$li("Settings: set color palettes for the visualizations in this dashboard.")
      ),
      
      div(class = "demographic-header", "Demographic Explorer"),
      
      # Tableau embed code
      div(class = 'tableauPlaceholder', id = 'viz1724361483716', style = 'position: relative;',
          tags$noscript(
            a(href = '#',
              img(alt = ' ', src = 'https://public.tableau.com/static/images/De/DemographicExplorer/ofPopulationwithaDisability/1_rss.png', style = 'border: none'))
          ),
          tags$object(class = 'tableauViz', style = 'display:none;',
                      tags$param(name = 'host_url', value = 'https%3A%2F%2Fpublic.tableau.com%2F'),
                      tags$param(name = 'embed_code_version', value = '3'),
                      tags$param(name = 'site_root', value = ''),
                      tags$param(name = 'name', value = 'DemographicExplorer/ofPopulationwithaDisability'),
                      tags$param(name = 'tabs', value = 'yes'),
                      tags$param(name = 'toolbar', value = 'yes'),
                      tags$param(name = 'static_image', value = 'https://public.tableau.com/static/images/De/DemographicExplorer/ofPopulationwithaDisability/1.png'),
                      tags$param(name = 'animate_transition', value = 'yes'),
                      tags$param(name = 'display_static_image', value = 'yes'),
                      tags$param(name = 'display_spinner', value = 'yes'),
                      tags$param(name = 'display_overlay', value = 'yes'),
                      tags$param(name = 'display_count', value = 'yes'),
                      tags$param(name = 'language', value = 'en-US')
          )
      ),
      tags$script(type = 'text/javascript',
                  HTML("
                     var divElement = document.getElementById('viz1724361483716');
                     var vizElement = divElement.getElementsByTagName('object')[0];
                     vizElement.style.width='100%';
                     vizElement.style.height=(divElement.offsetWidth*0.75)+'px';
                     var scriptElement = document.createElement('script');
                     scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
                     vizElement.parentNode.insertBefore(scriptElement, vizElement);")
      ),
      
      div(class = "section-title", "Since the ADA:"),
      tags$ul(
        class = "list-content",
        tags$li("Organizations across public and private sectors have diligently worked to collect, interpret, and analyze data to improve the quality of life for individuals with disabilities in the U.S."),
        tags$li("ADA-PARC emphasizes key components of Census and HUD data to shed light on the lived experiences and outcomes for people with disabilities.")
      ),
      
      div(class = "section-title", "Questions?"),
      a(href = "mailto:joyhammel@uic.edu", class = "email-button", "Email Joy Hammel"),
      div(class = "section-content", "Director of Graduate Studies UIC College of Applied Health Sciences"),
      
      div(class = "footer",
          "Application authors: Ethan Jantz, Sean Connelly, Jane Huber, Colin Heeneman, and Randy D. ColÃ³n",
          tags$br(),
          tags$a(href = "https://voorheescenter.uic.edu/", "UIC Voorhees Center")
      )
  )
)

server <- function(input, output) {

}

shinyApp(ui = ui, server = server)
```

::: {role="main"}
# National Data

::: {role="region" aria-labelledby="sidebar"}
## Sidebar {.sidebar}

<br>

To explore the data first select a category and then a topic. You can
navigate the boxes below using the mouse or keyboard. For keyboard
users, once the box is highlighted you can press backspace and begin
typing the selection into the box.

```{r national-sidebar, context="server", message=FALSE, warning=FALSE, fig.alt = "A sidebar containing two drop down menus. One selects a category, and the other selects a topic within that category. These other elements of this page will change based on the selected category and topic."}


### ----- Category selector ------

# National category selection widget
national_category_choices <- c(
  "Demographics" = "is_demographics", 
  "Community Participation" = "is_community_participation", 
  "Community Living" = "is_community_living", 
  "Work/Economic" = "is_work_economic"
)

# Select the data frame to use
selectInput(inputId = "national_category_selector", 
            label = "Select a category", 
            choices = names(national_category_choices),
            selected = "is_demographics",
            multiple = FALSE)

# Selected category for function inputs
# Output looks like "is_demographics"
national_category_selected <- reactive({ 
  
  getElement(national_category_choices, input$national_category_selector)
  
})

### ----- Variable selector  ------


# National variable selection choices, based on category
national_variable_choices <- reactive({
  
  tibble::deframe(
    dict_vars %>%
      filter(!!sym(national_category_selected()) == TRUE,
             !is.na(national_dropdown_label)) %>%
      select(national_dropdown_label, var_readable)
  )
  
})

# National variable selection widget, default options
selectInput(inputId = "national_variable_selector",
            label = "Select a topic",
            choices = tibble::deframe(c("Population", "pop_total")),
            selected = "pop_total",
            multiple = FALSE)

# Update variable selections when category changes
observeEvent(input$national_category_selector, {
  
  choices <- names(national_variable_choices())
  
  updateSelectInput(session, "national_variable_selector",
                    choices = choices, 
                    selected = choices[1])
  
})

# Try debouncing, didn't fire early enough
# national_variable_selector_db <- debounce(reactive({input$national_variable_selector}), 2000)

# Selected variable for function inputs
# Output looks like "pop_total"
national_variable_selected <- reactive({ 
  
  # req(national_variable_selector_db())
  req(national_category_selected())
  
  getElement(national_variable_choices(), input$national_variable_selector)
  
})

### For debugging
# renderText({ is.null(national_category_selected()) })
# renderText({ is.null(national_variable_selected()) })
# renderText({ national_category_selected() })
# renderText({ national_variable_selected() })
# renderText({ national_variable_choices() })


### ----- Summary text  ------


# Summary text
output$national_map_summary <- renderUI({
  
  national_variable_selected <- national_variable_selected()
  
  hud_data <- c("pwd_housing_choice_voucher_pct", "pwd_pubhousing_pct")
  
  # This text here is a hack--long term, source information should be authored in our pipeline and simply read here.
  
  if(national_variable_selected %in% hud_data) {
      source_text <- "2022 United States Department of Housing and Urban Development"

  } else {
      source_text <- "2018-2022 American Community Survey five-year estimates"

  }
  
  full_text <- paste0(" Detailed information is available to the right in the interactive map (top) and table (bottom).<br><br>Source: ", source_text)
  
  HTML(
    paste0(
      altText(national_data, 
              national_variable_selected), full_text)
  )
  
})

withSpinner(uiOutput("national_map_summary"))

```
:::

## Row {data-height="50"}

::: {role="region" aria-labelledby="section-national-title"}
```{r national-map-title, fig.alt = "Map title the selected topic."}

output$national_map_title <- renderUI({

  title <- dict_vars %>% 
    filter(var_readable == sym(national_variable_selected())) %>% 
    head(1) %>% 
    pull(national_dropdown_label) %>%
    sub(".*:", "", .) %>% 
    trimws()
  
  h4(title)

})

withSpinner(uiOutput("national_map_title"))


```
:::

## Row

::: {role="region" aria-labelledby="section-state-by-state-map-of-selected-topic"}
### 

```{r national-map, out.width = "100%", fig.align = "center", fig.cap= "A map of the United States, with each state shaded according to the quartiles described in the summary.", fig.alt= "A map of the United States, with each state shaded according to the quartiles described in the summary."}

output$national_ggmap <- renderPlot({
  
  render_national_map(national_variable_selected(), 
                      access_map_palette_selected())
  
})

output$national_map <- renderUI({
  
  withSpinner(plotOutput(outputId = "national_ggmap"))
  
})

uiOutput("national_map")



# For debugging
# Static version of comparison map
# render_national_map(
#   "is_demographics",
#   "pwd_pct",
#   "YlOrBr"
# )

```
:::

## Row

::: {role="region" aria-labelledby="section-table-of-selected-topic"}
###  {.table-wrapper}

```{r national-table, fig.alt = "Data table including state-level data for variables relevant to the selected topic."}

# Get variable group based on selected variable
national_vars_in_topic <- reactive({
  
  dict_vars %>% 
    filter((!!sym(national_category_selected())) == TRUE,
           var_topic ==
             (dict_vars %>% 
                filter((!!sym(national_category_selected())) == TRUE &
                       var_readable == national_variable_selected()) %>% 
                pull(var_topic)),
           display == T) %>% 
    select(var_pretty, var_readable)
  
  # # Static check
  # national_vars_in_topic_static <- dict_vars %>%
  #   filter(is_demographics == TRUE,
  #          var_topic ==
  #          (dict_vars %>%
  #             filter(is_demographics == TRUE,
  #                    var_readable == "pwd_18_64_pct") %>%
  #             pull(var_topic))) %>%
  #   select(var_pretty, var_readable)
  
})

# Caption
cap_choices <- c("Demographics" = "is_demographics", 
                 "Community Participation" = "is_community_participation", 
                 "Community Living" = "is_community_living", 
                 "Work/Economic" = "is_work_economic")

table_caption <- reactive({
  
  paste(names(cap_choices[cap_choices == national_category_selected()]), "Table")
  
})

# Reorganize dataframe, switch to pretty names
national_data_table_friendly <- reactive({
  
  national_data %>%
    arrange(GEOID) %>% 
    mutate("State" = paste0(NAME
    )
    ) %>% 
    select(any_of(c("State",
                    national_vars_in_topic() %>% 
                      pull(var_readable)))) %>% 
    mutate(across(ends_with("_pct"),
                  ~scales::percent(.x,
                                   accuracy = 0.1,
                                   scale = 1))) %>%
    rename(!!any_of(national_vars_in_topic() %>% 
                      deframe())) %>%
    select(State, starts_with("Population"), starts_with("Percent"), everything())
  
  # # Static check
  # table_friendly <- demographics %>%
  #   mutate("State" = paste0(NAME
  #                           # " (", ABBR, ")"
  #                           )) %>%
  #   select(any_of(c("State",
  #                   national_vars_in_topic_static %>%
  #                     pull(var_readable)))) %>%
  #   mutate(across(-State & -ends_with("_pct"),
  #                 ~scales::comma(.x))) %>%
  #   mutate(across(ends_with("_pct"),
  #                 ~scales::percent(.x,
  #                                  accuracy = 0.1,
  #                                  scale = 1))) %>%
  #   rename(!!any_of(national_vars_in_topic_static %>%
  #                     deframe()))
  
})

# UI Output
output$national_table <- renderUI({ 
  
  # This is incredibly hacky
  # But I can't find a better way to make these
  # tables accessible at this point in time
  HTML(
    tableHTML(national_data_table_friendly() %>% 
                mutate(State = paste0(State, "a")), rownames = F, class = "table_national") %>% 
      # Essentially, this respecifies the first column as a column of table headers. See link below
      # https://www.w3.org/WAI/tutorials/tables/two-headers/
      replace_html('<td id="tableHTML_column_1">', '<th scope="row" id="tableHTML_column_1">', replace_all = T) %>% 
      replace_html('[a-z]</td>', '</th>', replace_all = T)
  )
  
  # Static check
  # HTML(
  #   tableHTML(table_friendly %>%
  #               mutate(State = paste0(State, "a")),
  #             rownames = F, class = "table_national") %>%
  #     # Essentially, this respecifies the first column as a column of table headers. See link below
  #     # https://www.w3.org/WAI/tutorials/tables/two-headers/
  #     replace_html('<td id="tableHTML_column_1">', '<th scope="row" id="tableHTML_column_1">', replace_all = T) %>%
  #     replace_html('[a-z]</td>', '</th>', replace_all = T)
  # )
  
})

withSpinner(uiOutput("national_table"))

```
:::
:::

::: {role="main"}
# City Data

## Sidebar {.sidebar}

To explore the data select a city below. You can navigate the selection
boxes using the mouse or keyboard. For keyboard users, once the box is
highlighted you can press backspace and begin typing the selection into
the box. A state must be selected first.

```{r city-sidebar}

# Define inputs, restrict to cities in database

state_choices <- tibble(NAME = state.name, ABB =  state.abb) %>%
  add_row(NAME = c("District of Columbia", "Puerto Rico"),
          ABB = c("DC", "PR")) %>%
  deframe()

selectInput(inputId = "state_selector",
            label = "Select a state",
            choices = state_choices,
            selected = state_choices[13])

state_selected <- reactive({
  state_choices[which(state_choices == input$state_selector)]
})

# City choices, based on state, remove CDPs for now
city_choices <- reactive({
  
  tibble::deframe(
    dict_location_crosswalk %>%
      filter(state == state_selected(),
             !str_detect(place_NAME, " CDP")) %>%
      select(place_NAME, state, place_GEOID) %>%
      distinct(place_NAME, place_GEOID)
  ) %>%
    sort()
  
})

selectInput(inputId = "city_selector", 
            label = "Select a city", 
            choices =   tibble::deframe(
    dict_location_crosswalk %>%
      filter(state == "IL") %>%
      select(place_NAME, state, place_GEOID) %>%
      distinct(place_NAME, place_GEOID)
  ),
            selected = "1714000")

# Update variable selections when category changes
observeEvent(input$state_selector, {
  
  choices <- names(city_choices())
  
  updateSelectInput(session, "city_selector",
                    choices = choices, 
                    selected = choices[2])
  
})

city_selected <- reactive({ 
  
  # req(national_variable_selector_db())
  req(state_selected())
  
  getElement(city_choices(), input$city_selector)
  
})

### ----- Pull Census Place data for selected city -----

# Place for selected city
city_place <- reactive({

  city_place_geoids <- city_place_full%>% 
    filter(GEOID == city_selected())
  
    city_place_full %>% 
    filter(GEOID == city_selected())
  
})

### ----- Pull Census Tract data for selected city -----

# Spatial
city_tract_sf <- reactive({
  
  # Restrict tract call to selected city
  temp_city <- dict_location_crosswalk %>% 
    filter(place_GEOID %in% city_selected()) %>% 
    pull(tract_GEOID)
  
  temp_sf <- tracts_sf %>%
    filter(tract_GEOID %in% temp_city)
  
  return(temp_sf)
  
})

# Tabular
city_tract <- reactive ({
  
  temp_city <- dict_location_crosswalk %>%
    filter(place_GEOID %in% city_selected()) %>%
    pull(tract_GEOID)
  
  temp <- tracts_data %>%
    filter(GEOID %in% temp_city) 

  # # Connect and pull
  # temp_mongo_conn <- fun_mongo_connect(host_name,
  #                                      collection_name = "acs_tract_S1810",
  #                                      database_name = "ADA-PARC")
  # temp <- temp_mongo_conn$find(
  #   query = sprintf('{ "GEOID" : { "$in" : [  "%s" ] } }' ,
  #                   str_c(city_tract_sf()$t_GEOID, collapse = '", "')))
  return(temp)
  
})
```

## Row {data-height="50"}

::: {role="region" aria-labelledby="section-national-title"}
```{r city-map-title, fig.alt = "City Map Title"}

output$city_map_title <- renderUI({

  title <- city_place() %>% 
      mutate(NAME = str_replace_all(NAME, pattern = " (city|village|municipality|town), ", replacement = ", ")) %>% 
      pull(NAME)
  
  h4(title)
  
    # # Static check
    # altTitle(demographics,
    #         national_variable_selector_static)

  
})

withSpinner(uiOutput("city_map_title"))

```
:::

## Row

::: {role="region" aria-labelledby="section-people-with-disabilities-map"}
### 

```{r city-pwd-map, fig.alt="Map of people with disabilities by census tract in the selected city", context="server"}

 # Addison Village: 1700243 -- FOR TESTING
#   temp_city <- dict_location_crosswalk %>%
#     filter(place_GEOID == 1700243) %>%
#     pull(tract_GEOID)
#   
#   temp <- tracts_data %>%
#     filter(GEOID %in% temp_city) 
# 
#   # confirm pal_city works
# pal_city <- 
#   if(length(pull(temp, pwd_total)) < 4) {
#     colorNumeric(palette = "Yellow-Orange-Brown",
#                   domain = as.numeric(str_replace_all(city_tract$pwd_total, ",", "")))
#                  } else {
#     colorQuantile(palette = "Yellow-Orange-Brown",
#                   domain = as.numeric(str_replace_all(city_tract$pwd_total, ",", "")),
#                   n = 4)
#   }

  

######

  
  # Palette
pal_city <- reactive ({
  
  city_tract <- city_tract()
  city_tract_pwd_total <- as.numeric(str_replace_all(city_tract$pwd_total, ",", ""))
  map_palette <- access_map_palette_selected()

  if(length(city_tract_pwd_total) < 4) {
    colorNumeric(palette = map_palette,
                  domain = city_tract_pwd_total)
  } else {
    colorQuantile(palette = map_palette,
                  domain = city_tract_pwd_total,
                  n = 4)
  }
  
})

# Tract map
output$snapshotmap <- renderLeaflet({
  
  data <- left_join(
    city_tract_sf(),
    city_tract() %>% select(GEOID, pwd_total),
    by = c("tract_GEOID" = "GEOID")
  ) %>%
    mutate(pwd_total = as.numeric(str_replace_all(pwd_total, ",", "")))
  
  leaflet(data) %>%
    clearShapes() %>%
    addProviderTiles(providers$CartoDB.Positron) %>%
    addResetMapButton() %>%
    addPolygons(stroke = TRUE, color = "#444444",
                weight = 1, smoothFactor = 0,
                fillColor = ~pal_city()(pwd_total),
                fillOpacity = 0.5,
                layerId = ~ tract_GEOID) %>%
    addLegend(position = "topright", pal = pal_city(),
              values = ~ pwd_total,
              labFormat =  function(type, cuts, p) {
                n = length(cuts)
                paste0(as.numeric(cuts)[-n], " &ndash; ", as.numeric(cuts)[-1])
              },
              title = "# People With Disabilities") %>%
    addSearchOSM(options = searchOptions(autoCollapse = FALSE, minLength = 3,
                                         position = "topleft", zoom = 15,
                                         autoResize = FALSE,
                                         hideMarkerOnCollapse = TRUE))
  
})

withSpinner(leafletOutput("snapshotmap"))


```
:::

## Row

::: {role="region" aria-labelledby="section-city-summary"}
### 

```{r city-summary}

output$city_summary <- renderUI({

  create_number_percent_string <- function(num, pct) {

    #PCT requires special handling if it's NA because we want to construct it like " (NA%)"
    if (is.na(pct)) {
      pct_string <- " (NA%)"
    } else {
      pct_string <- paste0(" (",
                           scales::percent(as.numeric(pct), 
                                           accuracy = 0.1,
                                           scale = 1),
                           ")")
    }

    string <- paste0(num, pct_string)

    return(string)
  }

  # Overview text
  city_summary_text <- paste0(
    "<h5>People with Disabilities - Summary Tables</h5>",
    "Based on ACS 2022 5-Year Estimates, <b>", 
    city_place() %>%
      pull(pwd_total),
    "</b> of the city's <b>",
    city_place() %>%
      pull(pop_total),
    "</b> residents (<b>",
    city_place() %>%
      pull(pwd_pct),
    "%</b>) are people with disabilities.<br><br>")

  # Create summary items for Demographics
  city_summary_demo <- city_place() %>%
    mutate(
      "White" = create_number_percent_string(pwd_white_nonhisp, pwd_white_nonhisp_dis_pct),
      "Black" = create_number_percent_string(pwd_black, pwd_black_dis_pct),
      "Hispanic" = create_number_percent_string(pwd_hisp, pwd_hisp_dis_pct),
      "Asian" = create_number_percent_string(pwd_asian, pwd_asian_dis_pct),
      "Other" = create_number_percent_string(pwd_other_multiple, pwd_other_multiple_dis_pct),
      "Male" = create_number_percent_string(pwd_male, pwd_male_pct),
      "Female" = create_number_percent_string(pwd_female, pwd_female_pct),
      .keep = "none"
    ) %>%
    pivot_longer(everything(),
                 names_to = "Race/Ethnicity",
                 values_to = "Value (%)") %>%
    mutate("Bullets" = paste0('<li>', `Race/Ethnicity`, " &mdash; ",
                              `Value (%)`, '</li>')) %>%
    pull(Bullets) %>%
    str_c(collapse = "")

 # Create summary items for Type of Disability (no percentages)
  city_summary_disability <- city_place() %>%
    mutate(
      "Hearing" = pwd_hearing,
      "Vision" = pwd_vision,
      "Cognitive" = pwd_cognitive,
      "Ambulatory" = pwd_ambulatory,
      "Self-Care" = pwd_selfcare,
      "Independent Living" = pwd_indliving,
      .keep = "none"
    ) %>%
    pivot_longer(everything(),
                 names_to = "Type of Disability",
                 values_to = "Total") %>%
    mutate("Bullets" = paste0('<li>', `Type of Disability`, " &mdash; ",
                              Total, '</li>')) %>%
    pull(Bullets) %>%
    str_c(collapse = "")

  # Create summary items for 10 Key Indicators
city_summary_items <- city_place() %>%
  mutate(
    "PWD Living In Poverty" = create_number_percent_string(pwd_below_poverty, pwd_below_poverty_pct),
    "PWD Car Commute" = create_number_percent_string(pwd_car_commute, pwd_car_commute_pct),
    "PWD Public Transit" = create_number_percent_string(pwd_pub_transit, pwd_pub_transit_dis_pct),
    "PWD Walk or Bike" = create_number_percent_string(pwd_walk_bike, pwd_walk_bike_pct),
    "PWD Employed" = create_number_percent_string(pop_total_employed_16_plus, pwd_employed_subj),
    "PWD Not in Labor Force" = create_number_percent_string(pwd_not_in_labor_force, pwd_not_employed_subj),
    .keep = "none"
  ) %>%
  pivot_longer(everything(),
               names_to = "Indicator",
               values_to = "Value (%)") %>%
  mutate("Bullets" = paste0('<li>', Indicator, " &mdash; ",
                            `Value (%)`, '</li>')) %>%
  pull(Bullets) %>%
  str_c(collapse = "")

  # Place data in three separate columns under respective headers
  city_summary_tables <- paste0('<div class = "row">',
                                '<div class = "col-md-12">',
                                '<b>Demographics of Disabled Population</b><ul>',
                                city_summary_demo,
                                '</ul></div>',
                                '<div class = "col-md-12">',
                                '<b>Types of Disability</b><ul>',
                                city_summary_disability,
                                '</ul></div>',
                                '<div class = "col-md-12">',
                                '<b>Key Indicators</b><ul>',
                                city_summary_items,
                                '</ul></div>',
                                '</div>')

  # UI Output
  HTML(paste(city_summary_text, city_summary_tables, sep = ""))

})

withSpinner(uiOutput("city_summary"))
```
:::
:::

::: {role="main"}
# Scorecards - Excel Version

Scorecards for ADA-PARC translate measures across the three categories
of Community Living, Community Participation, and Work Economic into an
easy to interpret, comparative 100-point scale.

For more information on their structure, visit the 'Scorecards - Report' tab.

```{r excel scorecards}
library(shiny)
library(DT)
library(readxl)

# Load relative datasets
relative_community_living_data <- read_excel("scorecard/scorecard_data/relative/community_living_between_2022_excel.xlsx")
relative_community_participation_data <- read_excel("scorecard/scorecard_data/relative/community_participation_between_2022_excel.xlsx")
relative_work_economic_data <- read_excel("scorecard/scorecard_data/relative/work_economic_between_2022_excel.xlsx")



# Load equity datasets
equity_community_living_data <- read_excel("scorecard/scorecard_data/equity/community_living_within_2022_excel.xlsx")
equity_community_participation_data <- read_excel("scorecard/scorecard_data/equity/community_participation_within_2022_excel.xlsx")
equity_work_economic_data <- read_excel("scorecard/scorecard_data/equity/work_economic_within_2022_excel.xlsx")

shinyApp(
  ui = fluidPage(
    tags$head(
      tags$style(HTML("
        .dataTables_wrapper .dataTables_scrollBody {
          max-height: 1000px;
        }
      "))
    ),
    selectInput("dimension", "Select a dimension:", choices = c("Relative Scores", "Equity Scores"), selected = "Relative Scores"),
    uiOutput("category_selector"),
    uiOutput("scorecard_output")
  ),
  
  server = function(input, output, session) {
    
    # Dynamic UI for category selection based on the selected dimension
    output$category_selector <- renderUI({
      req(input$dimension)
      dimension <- input$dimension
      
      if (dimension == "Relative Scores") {
        selectInput("category", "Select a category:", 
                    choices = c("Community Living" = "relative_community_living", 
                                "Community Participation" = "relative_community_participation", 
                                "Work Economic" = "relative_work_economic"), 
                    selected = "relative_community_living")
      } else {
        selectInput("category", "Select a category:", 
                    choices = c("Community Living" = "equity_community_living", 
                                "Community Participation" = "equity_community_participation", 
                                "Work Economic" = "equity_work_economic"), 
                    selected = "equity_community_living")
      }
    })
    
    # Observe the selected dimension and category to render the corresponding scorecard
    output$scorecard_output <- renderUI({
      req(input$category)
      category <- input$category
      
      if (category == "relative_community_living") {
        DT::dataTableOutput("relative_community_living_table")
      } else if (category == "relative_community_participation") {
        DT::dataTableOutput("relative_community_participation_table")
      } else if (category == "relative_work_economic") {
        DT::dataTableOutput("relative_work_economic_table")
      } else if (category == "equity_community_living") {
        DT::dataTableOutput("equity_community_living_table")
      } else if (category == "equity_community_participation") {
        DT::dataTableOutput("equity_community_participation_table")
      } else if (category == "equity_work_economic") {
        DT::dataTableOutput("equity_work_economic_table")
      }
    })
    
    # Render Relative Scorecards
    output$relative_community_living_table <- DT::renderDataTable({
      DT::datatable(relative_community_living_data, options = list(pageLength = 20, autoWidth = TRUE, scrollY = "600px"))
    })
    
    output$relative_community_participation_table <- DT::renderDataTable({
      DT::datatable(relative_community_participation_data, options = list(pageLength = 20, autoWidth = TRUE, scrollY = "600px"))
    })
    
    output$relative_work_economic_table <- DT::renderDataTable({
      DT::datatable(relative_work_economic_data, options = list(pageLength = 20, autoWidth = TRUE, scrollY = "600px"))
    })
    
    # Render Equity Scorecards
    output$equity_community_living_table <- DT::renderDataTable({
      DT::datatable(equity_community_living_data, options = list(pageLength = 20, autoWidth = TRUE, scrollY = "600px"))
    })
    
    output$equity_community_participation_table <- DT::renderDataTable({
      DT::datatable(equity_community_participation_data, options = list(pageLength = 20, autoWidth = TRUE, scrollY = "600px"))
    })
    
    output$equity_work_economic_table <- DT::renderDataTable({
      DT::datatable(equity_work_economic_data, options = list(pageLength = 20, autoWidth = TRUE, scrollY = "600px"))
    })
  }
)


```
:::

::: {role="main"}
# Scorecards - Tableau Dashboard

```{r tableau scorecards}
shinyApp(
  ui = fluidPage(
    fluidRow(
      column(
        width = 3,
        div(class = "sidebar",
            br(),
            h4("To explore the data, select a dimension and a category below."),
            selectInput("dimension", "Select a dimension:", 
                        choices = c("Relative Scores", "Equity Scores"), 
                        selected = "Relative Scores"),
            uiOutput("category_selector"),
            br(),
            p(style = "font-size: 85%;",  
              "Scorecard dashboards are based on data from 2022 Census Data via the ACS. For more information on their logical structure and calculation methods, see the âScorecards - Reportâ tab.")
        )
      ),
      column(
        width = 9,
        div(class = "main-content",
            tags$head(
              tags$style(HTML("
                /* Setting a fixed height for the Tableau container */
                #tableauContainer {
                  width: 100%;
                  height: 1000px; /* Set the height to 800px or any value you prefer */
                  padding: 0;
                  margin: 0;
                }
                .tableauPlaceholder object {
                  width: 100%;
                  height: 100%;
                }
              "))
            ),
            div(id = "tableauContainer",
                uiOutput("scorecard_output")
            )
        )
      )
    )
  ),
  server = function(input, output, session) {
    
    
    # Dynamic UI for category selection based on the selected dimension
    output$category_selector <- renderUI({
      req(input$dimension)
      dimension <- input$dimension
      
      if (dimension == "Relative Scores") {
        selectInput("category", "Select a category:", 
                    choices = c("Community Living" = "relative_community_living", 
                                "Community Participation" = "relative_community_participation", 
                                "Work Economic" = "relative_work_economic"), 
                    selected = "relative_community_living")
      } else {
        selectInput("category", "Select a category:", 
                    choices = c("Community Living" = "equity_community_living", 
                                "Community Participation" = "equity_community_participation", 
                                "Work Economic" = "equity_work_economic"), 
                    selected = "equity_community_living")
      }
    })
    
output$scorecard_output <- renderUI({
  req(input$category)
  category <- input$category
  
  if (category == "relative_community_living") {
    tags$div(
      class = 'tableauPlaceholder', 
      id = 'viz1724259305927',
      style = 'width: 100%; height: 100%;',
      tags$noscript(
        tags$a(
          href = '#',
          tags$img(
            alt = 'Housing Voucher Choice Table',
            src = 'https://public.tableau.com/static/images/Re/Relative_Living_Dash/HousingVoucherChoiceTable/1_rss.png',
            style = 'border: none'
          )
        )
      ),
      tags$object(
        class = 'tableauViz',
        style = 'width: 100%; height: 100%;',
        tags$param(name = 'host_url', value = 'https%3A%2F%2Fpublic.tableau.com%2F'),
        tags$param(name = 'embed_code_version', value = '3'),
        tags$param(name = 'site_root', value = ''),
        tags$param(name = 'name', value = 'Relative_Living_Dash/HousingVoucherChoiceTable'),
        tags$param(name = 'tabs', value = 'yes'),
        tags$param(name = 'toolbar', value = 'yes'),
        tags$param(name = 'static_image', value = 'https://public.tableau.com/static/images/Re/Relative_Living_Dash/HousingVoucherChoiceTable/1.png'),
        tags$param(name = 'animate_transition', value = 'yes'),
        tags$param(name = 'display_static_image', value = 'yes'),
        tags$param(name = 'display_spinner', value = 'yes'),
        tags$param(name = 'display_overlay', value = 'yes'),
        tags$param(name = 'display_count', value = 'yes'),
        tags$param(name = 'language', value = 'en-US')
      ),
      tags$script(
        HTML("
          var divElement = document.getElementById('viz1724259305927');
          var vizElement = divElement.getElementsByTagName('object')[0];
          vizElement.style.width='100%';
          vizElement.style.height=(divElement.offsetWidth*0.75)+'px';
          var scriptElement = document.createElement('script');
          scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
          vizElement.parentNode.insertBefore(scriptElement, vizElement);
        ")
      )
    )
  } else if (category == "relative_community_participation") {
    tags$div(
      class = 'tableauPlaceholder', 
      id = 'viz1724259347079',
      style = 'width: 100%; height: 100%;',
      tags$noscript(
        tags$a(
          href = '#',
          tags$img(
            alt = 'Smartphone Access Table',
            src = 'https://public.tableau.com/static/images/Re/Relative_Participation_Dash/SmartphoneAccessTable/1_rss.png',
            style = 'border: none'
          )
        )
      ),
      tags$object(
        class = 'tableauViz',
        style = 'width: 100%; height: 100%;',
        tags$param(name = 'host_url', value = 'https%3A%2F%2Fpublic.tableau.com%2F'),
        tags$param(name = 'embed_code_version', value = '3'),
        tags$param(name = 'site_root', value = ''),
        tags$param(name = 'name', value = 'Relative_Participation_Dash/SmartphoneAccessTable'),
        tags$param(name = 'tabs', value = 'yes'),
        tags$param(name = 'toolbar', value = 'yes'),
        tags$param(name = 'static_image', value = 'https://public.tableau.com/static/images/Re/Relative_Participation_Dash/SmartphoneAccessTable/1.png'),
        tags$param(name = 'animate_transition', value = 'yes'),
        tags$param(name = 'display_static_image', value = 'yes'),
        tags$param(name = 'display_spinner', value = 'yes'),
        tags$param(name = 'display_overlay', value = 'yes'),
        tags$param(name = 'display_count', value = 'yes'),
        tags$param(name = 'language', value = 'en-US')
      ),
      tags$script(
        HTML("
          var divElement = document.getElementById('viz1724259347079');
          var vizElement = divElement.getElementsByTagName('object')[0];
          vizElement.style.width='100%';
          vizElement.style.height=(divElement.offsetWidth*0.75)+'px';
          var scriptElement = document.createElement('script');
          scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
          vizElement.parentNode.insertBefore(scriptElement, vizElement);
        ")
      )
    )
  } else if (category == "relative_work_economic") {
  tags$div(
    class = 'tableauPlaceholder', 
    id = 'viz1724260870153',
    style = 'position: relative;',
    tags$noscript(
      tags$a(
        href = '#',
        tags$img(
          alt = ' ',
          src = 'https://public.tableau.com/static/images/Re/Relative_Work_Dash/WorkEconomicOverallMap/1_rss.png',
          style = 'border: none'
        )
      )
    ),
    tags$object(
      class = 'tableauViz',
      style = 'display: none;',
      tags$param(name = 'host_url', value = 'https%3A%2F%2Fpublic.tableau.com%2F'),
      tags$param(name = 'embed_code_version', value = '3'),
      tags$param(name = 'site_root', value = ''),
      tags$param(name = 'name', value = 'Relative_Work_Dash/WorkEconomicOverallMap'),
      tags$param(name = 'tabs', value = 'yes'),
      tags$param(name = 'toolbar', value = 'yes'),
      tags$param(name = 'static_image', value = 'https://public.tableau.com/static/images/Re/Relative_Work_Dash/WorkEconomicOverallMap/1.png'),
      tags$param(name = 'animate_transition', value = 'yes'),
      tags$param(name = 'display_static_image', value = 'yes'),
      tags$param(name = 'display_spinner', value = 'yes'),
      tags$param(name = 'display_overlay', value = 'yes'),
      tags$param(name = 'display_count', value = 'yes'),
      tags$param(name = 'language', value = 'en-US')
    ),
    tags$script(
      HTML("
        var divElement = document.getElementById('viz1724260870153');
        var vizElement = divElement.getElementsByTagName('object')[0];
        vizElement.style.width='100%';
        vizElement.style.height=(divElement.offsetWidth*0.75)+'px';
        var scriptElement = document.createElement('script');
        scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
        vizElement.parentNode.insertBefore(scriptElement, vizElement);
      ")
      )
    )
  } else if (category == "equity_community_living") {
    tags$div(
      class = 'tableauPlaceholder', 
      id = 'viz1724259389021',
      style = 'width: 100%; height: 100%;',
      tags$noscript(
        tags$a(
          href = '#',
          tags$img(
            alt = 'All Measures Table - Community Living',
            src = 'https://public.tableau.com/static/images/Di/Disparity_Living_Dash/AllMeasuresTable/1_rss.png',
            style = 'border: none'
          )
        )
      ),
      tags$object(
        class = 'tableauViz',
        style = 'width: 100%; height: 100%;',
        tags$param(name = 'host_url', value = 'https%3A%2F%2Fpublic.tableau.com%2F'),
        tags$param(name = 'embed_code_version', value = '3'),
        tags$param(name = 'site_root', value = ''),
        tags$param(name = 'name', value = 'Disparity_Living_Dash/AllMeasuresTable'),
        tags$param(name = 'tabs', value = 'yes'),
        tags$param(name = 'toolbar', value = 'yes'),
        tags$param(name = 'static_image', value = 'https://public.tableau.com/static/images/Di/Disparity_Living_Dash/AllMeasuresTable/1.png'),
        tags$param(name = 'animate_transition', value = 'yes'),
        tags$param(name = 'display_static_image', value = 'yes'),
        tags$param(name = 'display_spinner', value = 'yes'),
        tags$param(name = 'display_overlay', value = 'yes'),
        tags$param(name = 'display_count', value = 'yes'),
        tags$param(name = 'language', value = 'en-US')
      ),
      tags$script(
        HTML("
          var divElement = document.getElementById('viz1724259389021');
          var vizElement = divElement.getElementsByTagName('object')[0];
          vizElement.style.width='100%';
          vizElement.style.height=(divElement.offsetWidth*0.75)+'px';
          var scriptElement = document.createElement('script');
          scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
          vizElement.parentNode.insertBefore(scriptElement, vizElement);
        ")
      )
    )
  } else if (category == "equity_community_participation") {
    tags$div(
      class = 'tableauPlaceholder', 
      id = 'viz1724259406272',
      style = 'width: 100%; height: 100%;',
      tags$noscript(
        tags$a(
          href = '#',
          tags$img(
            alt = 'All Measures Table - Community Participation',
            src = 'https://public.tableau.com/static/images/Di/Disparity_Participation_Dash/AllMeasuresTable/1_rss.png',
            style = 'border: none'
          )
        )
      ),
      tags$object(
        class = 'tableauViz',
        style = 'width: 100%; height: 100%;',
        tags$param(name = 'host_url', value = 'https%3A%2F%2Fpublic.tableau.com%2F'),
        tags$param(name = 'embed_code_version', value = '3'),
        tags$param(name = 'site_root', value = ''),
        tags$param(name = 'name', value = 'Disparity_Participation_Dash/AllMeasuresTable'),
        tags$param(name = 'tabs', value = 'yes'),
        tags$param(name = 'toolbar', value = 'yes'),
        tags$param(name = 'static_image', value = 'https://public.tableau.com/static/images/Di/Disparity_Participation_Dash/AllMeasuresTable/1.png'),
        tags$param(name = 'animate_transition', value = 'yes'),
        tags$param(name = 'display_static_image', value = 'yes'),
        tags$param(name = 'display_spinner', value = 'yes'),
        tags$param(name = 'display_overlay', value = 'yes'),
        tags$param(name = 'display_count', value = 'yes'),
        tags$param(name = 'language', value = 'en-US')
      ),
      tags$script(
        HTML("
          var divElement = document.getElementById('viz1724259406272');
          var vizElement = divElement.getElementsByTagName('object')[0];
          vizElement.style.width='100%';
          vizElement.style.height=(divElement.offsetWidth*0.75)+'px';
          var scriptElement = document.createElement('script');
          scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
          vizElement.parentNode.insertBefore(scriptElement, vizElement);
        ")
      )
    )
  } else if (category == "equity_work_economic") {
    tags$div(
      class = 'tableauPlaceholder', 
      id = 'viz1724259422737',
      style = 'width: 100%; height: 100%;',
      tags$noscript(
        tags$a(
          href = '#',
          tags$img(
            alt = 'Not in Labor Force Table',
            src = 'https://public.tableau.com/static/images/Di/Disparity_Work_Dash/NotinLaborForceTable/1_rss.png',
            style = 'border: none'
          )
        )
      ),
      tags$object(
        class = 'tableauViz',
        style = 'width: 100%; height: 100%;',
        tags$param(name = 'host_url', value = 'https%3A%2F%2Fpublic.tableau.com%2F'),
        tags$param(name = 'embed_code_version', value = '3'),
        tags$param(name = 'site_root', value = ''),
        tags$param(name = 'name', value = 'Disparity_Work_Dash/NotinLaborForceTable'),
        tags$param(name = 'tabs', value = 'yes'),
        tags$param(name = 'toolbar', value = 'yes'),
        tags$param(name = 'static_image', value = 'https://public.tableau.com/static/images/Di/Disparity_Work_Dash/NotinLaborForceTable/1.png'),
        tags$param(name = 'animate_transition', value = 'yes'),
        tags$param(name = 'display_static_image', value = 'yes'),
        tags$param(name = 'display_spinner', value = 'yes'),
        tags$param(name = 'display_overlay', value = 'yes'),
        tags$param(name = 'display_count', value = 'yes'),
        tags$param(name = 'language', value = 'en-US')
      ),
      tags$script(
        HTML("
          var divElement = document.getElementById('viz1724259422737');
          var vizElement = divElement.getElementsByTagName('object')[0];
          vizElement.style.width='100%';
          vizElement.style.height=(divElement.offsetWidth*0.75)+'px';
          var scriptElement = document.createElement('script');
          scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
          vizElement.parentNode.insertBefore(scriptElement, vizElement);
        ")
          )
        )
      }
    })
  }
)
```
:::

::: {role="main"}
# Scorecards - Report

The scorecard report is available below. You can scroll through the report and download it directly from the viewer.

```{r scorecard report}
# Embed the PDF using iframe with improved style and added download link
tags$div(
  style="text-align: center;",
  tags$iframe(
    style="height:600px; width:100%; border:none; overflow-y:scroll;", 
    src="scorecard/report/ADA-PARC_scorecard_report_pdf.pdf"
  ),
  tags$br(),
  tags$a(
    href="scorecard/report/ADA-PARC_scorecard_report_pdf.pdf", 
    download="ADA-PARC_scorecard_report.pdf",
    "Download the report"
  )
)

```

:::

::: {role="main"}
# About

```{r about_documentation}

# creating separate 'About' page per website re-design vision

```

Welcome to the ADA-PARC website. The ADA-PARC is a collaborative
research project of ten Americans with Disabilities Act (ADA) Regional
Centers.

<br>

#### Purpose of ADA-PARC

The ADA-PARC research has four purposes:

1.  **To look at participation disparities** experienced by people with
    disabilities post ADA & Olmstead
2.  **To identify & examine key environmental factors** contributing to
    these disparities
3.  **To benchmark participation disparities and highlight promising
    practices** at state & city levels
4.  **To action-plan strategies for dissemination and utilization of
    findings** to be used by ADA Centers and others in community
    capacity building & systems change initiatives

<br>

#### The Work of the ADA-PARC

The ADA-PARC has research teams focused on Community Living, Community
Participation & Work/Economic Participation measures and uses Regional
Steering Committees in each of the ten participating regions to gather,
review, and choose appropriate data to achieve the project's purposes.
The data are mainly from national data sources that have enough
statistical power to be relevant on the local level.

The intent of this effort is to use this information to inform:

1.  ADA Center technical assistance and resource dissemination, and
2.  Community level stakeholders to increase participation opportunities
    in their communities.

<br>

#### Who is the ADA-PARC

The ten participating ADA-Regional Centers in the ADA-PARC are:

-   Region 1 New England ADA Center
-   Region 2 Northeast ADA Center
-   Region 3 Mid-Atlantic ADA Center
-   Region 4 Southeast ADA Center
-   Region 5 Great Lakes ADA Center
-   Region 6 Southwest ADA Center
-   Region 7 Great Plains ADA Center
-   Region 8 Rocky Mountain ADA Center
-   Region 9 Pacific ADA Center
-   Region 10 Northwest ADA Center

Other institutions collaborating in the ADA-PARC are:

-   The ADA Knowledge Translation Center
-   The Center on Disability at the Public Health Institute
-   TIRR Memorial Hermann
-   Syracuse University
-   The University of Illinois at Chicago
-   The University of Northern Colorado

<br>

<img src="./www/participant_logos.png" alt="The ten participating ADA-Regional Centers" width="75%"/>

<br>

The ADA-PARC website is a collection of public data sets that can help
shed light on the status of people with disabilities in local
communities. The data includes national, state, county, and city data.
In addition to Demographic data describing the population, the three
main areas of data to illuminate the status of disability in an area
are: Community Living, Community Participation and Work & Economics.
Each of the three areas presents data in map form as well as in tabular
form. A summary of what is important about the data is presented on each
page. The data source is described along with the calculation to arrive
at the values used in the tables and maps. Data is first presented by
state, and then if available, at county and city level.

#### Grant Identifying Information

The ADA Participation Action Consortium is funded by the National
Institute on Disability, Independent Living, and Rehabilitation Research
(NIDILRR) (90DP0026 and 90DPAD0001). NIDILRR is a Center within the
Administration for Community Living (ACL), Department of Health and
Human Services (HHS). The contents of this website do not necessarily
represent the policy of NIDILRR, ACL, HHS, and you should not assume
endorsement by the Federal Government.
:::

# Settings

::: {role="main"}
###  {.long-row}

```{r accessibility-page-body}

# Map palette
access_map_palette_choices <- list(
  "Yellow-Orange-Brown" = "YlOrBr", 
  "Yellow-Orange-Red" = "YlOrRd", 
  "Green-Blue" = "GnBu")

selectInput(inputId = "access_map_palette",
            label = h5("Select a color palette for maps:"),
            choices = names(access_map_palette_choices),
            selected = "Yellow-Orange-Brown")

access_map_palette_selected <- reactive({
  access_map_palette_choices[[input$access_map_palette]] })

# GGplot themes and colors
access_ggplot_theme_choices <- list(
  "The Economist" = list(theme_economist(), scale_fill_economist(), scale_color_economist()),
  "Five Thirty Eight" = list(theme_fivethirtyeight(), scale_fill_economist(), scale_color_fivethirtyeight()),
  "Highcharts" = list(theme_hc(), scale_fill_hc(), scale_color_hc()),
  "Ipsum" = list(theme_ipsum(), scale_fill_colorblind(), scale_color_colorblind()),
  "Light" = list(theme_light(), scale_fill_colorblind(), scale_color_colorblind()),
  "Minimal" = list(theme_minimal(),scale_fill_ordinal(), scale_color_ordinal()),
  "Stata" = list(theme_stata(), scale_fill_stata(), scale_color_stata()))

# Hide selector for now since city data plots are excluded
# selectInput(inputId = "access_ggplot_theme", 
#             label = h5("Select a theme for plots:"), 
#             choices = names(access_ggplot_theme_choices),
#             selected = "Ipsum")

ggplot_theme_selected <- reactive({ access_ggplot_theme_choices[[input$access_ggplot_theme]][1] })
ggplot_fill_selected <- reactive({ access_ggplot_theme_choices[[input$access_ggplot_theme]][2] }) 
ggplot_color_selected <- reactive({ access_ggplot_theme_choices[[input$access_ggplot_theme]][3] }) 

```
:::

<!-- Custom Javascript  -->

```{=html}
<script>
$("body").on("shown.bs.tab", "a[data-toggle='tab']", function(e) {
Shiny.setInputValue("active_tab", $(e.target).parent().index());
})
</script>
```
<!-- CSS for dashboard  -->

```{=html}
<style type="text/css">

/* #################### */
/* Fonts */
/* #################### */

/* Headers */
h2,h3,h4,h5 { 
font-weight: bold;
}

/* Section title color */
h3 { 
color: black;
}

/* #################### */
/* Coloring */
/* #################### */

/* Leaflet border */
.leaflet .legend i{
border-left:1px solid #000000;
border-right:1px solid #000000;
border-top:1px solid #000000;
border-bottom:1px solid #000000;
}

/* Leaflet background */
.leaflet-container {
background: #ddd;
}

/* Section dividers */
.section-divider { 
background-color: #CCCCCC;
color: #000000;
}

/* Selector widget Active Option */
.item {
background: white !important;
color: black !important;
}
.selectize-dropdown-content .active {
background: #EFEFEF !important;
color: black !important;
border-left:1px solid #000000;
border-right:1px solid #000000;
border-top:1px solid #000000;
border-bottom:1px solid #000000;
}

/* Kable caption colors (darken to meet contrast requirements) */
caption {
color: black;
font-weight: bold;
}


/* #################### */
/* Containers */
/* #################### */

/* Set max length for dropdowns */
.selectize-dropdown-content {
padding: 10px;
}

/* Allow dropdowns to be visible for short containers */
#access_ggplot_theme+ div>.selectize-dropdown, #access_map_palette+ div>.selectize-dropdown {
position: static;
}

/* Have dropdowns display on top of Leaflet */
.selectize-dropdown {
z-index: 10000;
overflow-y: auto;
}

/* Scroll overflow for tables */
.table-wrapper {
overflow-x: scroll;
overflow-y: scroll;
}

</style>
```
