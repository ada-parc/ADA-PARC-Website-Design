demo_gen_data <- demographics %>%
filter(is.na(city)) %>%
select("state_name" = state, "state_abbv" = abbrev,
percent_of_total_population_with_a_disability, pwd, total_population) %>%
mutate(percent_of_total_population_with_a_disability =
round(percent_of_total_population_with_a_disability, 1))
# SF data and palette
demo_gen_map_data <- demo_gen_data %>%
left_join(states_sf, ., by = c("state_name", "state_abbv")) %>%
st_transform(4326)
demo_gen_selected <- reactive({ "percent_of_total_population_with_a_disability" })
pal_demo1 <- reactive ({
colorNumeric(palette = input$access_map_palette,
domain = pull(demo_gen_data, !!sym(demo_gen_selected())))
})
# State map
output$demo1map <- renderLeaflet({
# Map
demo1map <- demo_gen_map_data %>%
mutate(map_focus = !!sym(demo_gen_selected())) %>%
leaflet() %>%
clearShapes() %>%
addResetMapButton() %>%
addPolygons(stroke = TRUE, color = "#444444", weight = 1, smoothFactor = 0,
fillColor = ~pal_demo1()(map_focus),
fillOpacity = 1,
popup = ~paste(state_name, " (", state_abbv, ")", "<br>",
percent(map_focus,
scale = 1, accuracy = 0.1)),
layerId = ~state_name) %>%
addLegend(position = "topright", pal = pal_demo1(),
values = ~map_focus,
title = paste0("PWD (%),<br>", input$demo_gen_type))
demo1map
})
# Click event for the map
click_demo1map <- eventReactive(input$demo1map_shape_click, {
x <- input$demo1map_shape_click
y <- x$id
return(y)
})
# Add the clicked state to the map, and remove when a new one is clicked
observe({
req(click_demo1map())
demo1map <- leafletProxy("demo1map") %>%
removeShape("highlight_state") %>%
addPolygons(data = demo_gen_map_data[demo_gen_map_data$state_name == click_demo1map(), ],
fill = FALSE, weight = 3,
color = "#00FFFF", opacity = 1, layerId = "highlight_state")
})
# Fetch data for the clicked state
demo_gen_data_selected <- reactive({
if(is.null(input$demo1map_shape_click)){
demo_gen_data
} else {
demo_gen_data %>%
filter(state_name == click_demo1map())
}
})
leafletOutput("demo1map")
# Chunk 4
# Data table
DT::renderDataTable({
# Table
DT::datatable(
demo_gen_data_selected() %>%
rename("percent_pwd" = percent_of_total_population_with_a_disability,
"total_pop" = total_population) %>%
mutate(percent_pwd = percent(percent_pwd, scale = 1, accuracy = 0.1),
pwd = comma(pwd),
total_pop = comma(total_pop)),
options(scrollX = "200px"))
})
# Chunk 5
# Data for this section
demo_age_data <- demographics %>%
filter(is.na(city)) %>%
select("state_name" = state, "state_abbv" = abbrev,
percent_people_18_64_with_a_disability, pwd_18_64_years, total_population18_64,
percent_people_65_with_a_disability, pwd_65_years, total_population65) %>%
mutate(across(starts_with("percent"), round, 1))
# SF data and palette
demo_age_map_data <- demo_age_data %>%
left_join(states_sf, ., by = c("state_name", "state_abbv")) %>%
st_transform(4326)
# Input for column to map
selectInput("demo_age_type",
label = "Select a category",
choices = c("18-64", "65+"),
selected = "18-64")
demo_age_selected <- reactive({
if (input$demo_age_type == "18-64"){
"percent_people_18_64_with_a_disability"
} else {
"percent_people_65_with_a_disability"
}
})
pal_demo2 <- reactive ({
colorNumeric(palette = input$access_map_palette,
domain = pull(demo_age_data, !!sym(demo_age_selected())))
})
# State map
output$demo2map <- renderLeaflet({
# Map
demo2map <- demo_age_map_data %>%
mutate(map_focus = !!sym(demo_age_selected())) %>%
leaflet() %>%
clearShapes() %>%
addResetMapButton() %>%
addPolygons(stroke = TRUE, color = "#444444", weight = 1, smoothFactor = 0,
fillColor = ~pal_demo2()(map_focus),
fillOpacity = 1,
popup = ~paste(state_name, " (", state_abbv, ")", "<br>",
percent(map_focus,
scale = 1, accuracy = 0.1)),
layerId = ~state_name) %>%
addLegend(position = "topright", pal = pal_demo2(),
values = ~map_focus,
title = paste0("PWD (%),<br>", input$demo_age_type))
demo2map
})
# Click event for the map
click_demo2map <- eventReactive(input$demo2map_shape_click, {
x <- input$demo2map_shape_click
y <- x$id
return(y)
})
# Add the clicked state to the map, and remove when a new one is clicked
observe({
req(click_demo2map())
demo2map <- leafletProxy("demo2map") %>%
removeShape("highlight_state") %>%
addPolygons(data = demo_age_map_data[demo_age_map_data$state_name == click_demo2map(), ],
fill = FALSE, weight = 3,
color = "#00FFFF", opacity = 1, layerId = "highlight_state")
})
# Fetch data for the clicked state
demo_age_data_selected <- reactive({
if(is.null(input$demo2map_shape_click)){
demo_age_data
} else {
demo_age_data %>%
filter(state_name == click_demo2map())
}
})
leafletOutput("demo2map")
# Chunk 6
# Columns to show
demo_age_cols_selected <- reactive({
if (input$demo_age_type == "18-64"){
"18_64"
} else {
"65"
}
})
# Data table
DT::renderDataTable({
# Table
DT::datatable(
demo_age_data_selected() %>%
rename("percent_pwd_18_64" = percent_people_18_64_with_a_disability,
"pwd_18_64" = pwd_18_64_years,
"total_pop_18_64" = total_population18_64,
"percent_pwd_65+" =percent_people_65_with_a_disability,
"pwd_65+" = pwd_65_years,
"total_pop_65+" = total_population65) %>%
mutate(across(matches("percent"), percent, scale = 1, accuracy = 0.1),
across(where(is.numeric), comma)) %>%
select(starts_with("state"), matches(demo_age_cols_selected())),
options(scrollX = "200px"))
})
# Data for this section
demo_race_data <- demographics %>%
filter(is.na(city)) %>%
select("state_name" = state, "state_abbv" = abbrev,
pwd_caucasian:percent_of_pwd_who_are_white_non_hispanic, pwd) %>%
mutate(across(starts_with("percent"), round, 1))
View(demo_race_data)
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot() +
geom_bar(aes(x = state_abbv, fill = Race), position = "fill")
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot() +
geom_bar(aes(x = state_abbv, y = Percent, fill = Race), position = "fill")
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot() +
geom_bar(aes(x = state_abbv, y = Percent, fill = Race))
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent")
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot() +
geom_bar(aes(x = state_abbv, fill = Race), position = "fill")
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5)
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = fct_infreq(Race))) +
geom_bar(stat = "identity", width = 0.5)
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
geom_text(aes(y = Percent, label = paste0(Percent, "%")),
position = position_fill(vjust = 0.5)) +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
geom_text(aes(label = paste0(Percent, "%")),
position = position_fill(vjust = 0.5))
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
scale_x_discrete(limits = rev(state_abbv)) +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = rev(state_abbv), y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5)
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = rev(state_abbv), y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
labs(x = "State", y = "Percent") +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
scale_x_reverse() +
labs(x = "State", y = "Percent") +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100)
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
#scale_x_reverse() +
labs(x = "State", y = "Percent") +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
scale_x_discrete(limits = rev(levels(as_factor(state_abbv)))) +
labs(x = "State", y = "Percent") +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
mutate(state_abbv = as_factor(state_abbv)) %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
scale_x_discrete(limits = rev(levels(state_abbv))) +
labs(x = "State", y = "Percent") +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
mutate(state_abbv = as_factor(state_abbv)) %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100)
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
mutate(state_abbv = as_factor(state_abbv)) %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
scale_x_discrete(limits = rev(state_abbv))
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
mutate(state_abbv = as_factor(state_abbv)) %>%
ggplot(aes(x = state_abbv, y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
scale_x_discrete(limits = fct_rev(state_abbv)) +
labs(x = "State", y = "Percent") +
coord_flip()
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
mutate(state_abbv = as_factor(state_abbv)) %>%
ggplot(aes(x = fct_rev(state_abbv), y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
labs(x = "State", y = "Percent") +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
mutate(state_abbv = as_factor(state_abbv))
emo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
mutate(state_abbv = as_factor(state_abbv)) %>%
ggplot(aes(x = fct_rev(state_abbv), y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
labs(x = "State", y = "Percent") +
coord_flip()
demo_race_data %>%
select(state_name, state_abbv,
"Black" = percent_of_pwd_who_are_black_african_american,
"White, Non-Hispanic" = percent_of_pwd_who_are_white_non_hispanic,
"Hispanic" = percent_of_pwd_who_are_hispanic,
"Another Race" = percent_of_pwd_who_are_of_another_race) %>%
pivot_longer(cols = Black:`Another Race`,
names_to = "Race",
values_to = "Percent") %>%
mutate(state_abbv = as_factor(state_abbv)) %>%
ggplot(aes(x = fct_rev(state_abbv), y = Percent, fill = Race)) +
geom_bar(stat = "identity", width = 0.5) +
ylim(0 ,100) +
labs(x = "State", y = "Percent") +
coord_flip()
library(rsconnect)
rsconnect::deployApp("E:/UIC/Voorhees/ADA-PARC/ADA PARC Website Design/ADA_PARC.rmd")
