# Write each ACS table to database separately
dbWriteTable(conn = conn,
name = "acs_C21007",
value = block_groups_pwd,
overwrite = TRUE)
# Write each ACS table to database separately
dbWriteTable(conn = conn,
name = "acs_C21007",
value = block_groups_pwd,
overwrite = TRUE)
write_csv(block_groups_pwd, path = "block_groups_pwd.csv")
library(tidyverse);library(readxl)
library(tigris);library(sf);library(janitor)
library(tidycensus);library(viridis);library(tmap)
library(RPostgres);library(RPostgreSQL);library(DBI)
library(geojsonsf);library(mongolite)
# Set tigris option to TRUE for Census geometries
# to load with ACS data call in first section of script
options(tigris_use_cache = TRUE)
# Must load census API key to call data
source("secret.R", local = TRUE)
census_api_key(api_key_census)
# Set working directory to current path
setwd(here::here())
conn <- dbConnect(RPostgres::Postgres(),
dbname = "ADA-PARC",
host = "localhost",
port = "5432",
user = "postgres",
password = "Voorhees1")
block_groups_sf <- st_read(conn, layer = "geo_block_group")
lookup_var <- dbGetQuery(conn, "SELECT * FROM acs_variable_lu")
block_groups_pwd <- dbGetQuery(conn, 'SELECT * FROM public."acs_C21007"')
# Connect to MongoDB database/collection
mongo_conn <- mongo_conn(collection_name = "geo_block_group",
database_name = "ADA-PARC")
# Write to database and add spatial index
mongo_conn$drop
mongo_conn$insert(geojsonsf::sf_geojson(block_groups_sf, atomise = TRUE))
mongo_conn$index((add = '{"geometry" : "2dsphere"}'))
# Disconnect
temp_geo <- mongo_conn$iterate(query = "{}")
test <- geojsonsf::geojson_sf(temp_geo$json(size = 100000))
View(test)
mongo_conn$drop
block_groups_sf <- block_groups_sf %>% rename("GEOID" = block_group_fips,
"NAME" = block_group_name)
mongo_conn$drop
mongo_conn$insert(geojsonsf::sf_geojson(block_groups_sf, atomise = TRUE))
mongo_conn$index((add = '{"geometry" : "2dsphere"}'))
# Connect to MongoDB database/collection
mongo_conn <- mongo_conn(collection_name = "geo_block_group",
database_name = "ADA-PARC")
# Write to database and add spatial index
mongo_conn$insert(geojsonsf::sf_geojson(block_groups_sf, atomise = TRUE))
mongo_conn$index((add = '{"geometry" : "2dsphere"}'))
library(tidyverse);library(readxl)
library(tigris);library(sf);library(janitor)
library(tidycensus);library(viridis);library(tmap)
library(RPostgres);library(RPostgreSQL);library(DBI)
library(geojsonsf);library(mongolite)
# Set tigris option to TRUE for Census geometries
# to load with ACS data call in first section of script
options(tigris_use_cache = TRUE)
# Must load census API key to call data
source("secret.R", local = TRUE)
census_api_key(api_key_census)
# Set working directory to current path
setwd(here::here())
mongo_conn <- mongo_conn(collection_name = "geo_block_group",
database_name = "ADA-PARC")
# Write to database and add spatial index
mongo_conn$insert(geojsonsf::sf_geojson(block_groups_sf, atomise = TRUE))
mongo_conn$index((add = '{"geometry" : "2dsphere"}'))
test <- geojsonsf::sf_geojson(block_groups_sf, atomise = TRUE)
mongo_conn$drop()
mongo_conn$insert(temp_geo)
temp_geo <- geojsonsf::sf_geojson(block_groups_sf, atomise = TRUE)
mongo_conn$insert(temp_geo)
mongo_conn$index((add = '{"geometry" : "2dsphere"}'))
temp_geo <- mongo_conn$iterate(query = "{}")
test <- geojsonsf::geojson_sf(temp_geo$json(size = 100000))
View(test)
# Disconnect
rm(mongo_conn)
rm(temp_geo)
# Disconnect
rm(mongo_conn)
# Connect to MongoDB database/collection
mongo_conn <- mongo_conn(collection_name = "acs_variable_lu",
database_name = "ADA-PARC")
# Write to database and add spatial index
mongo_conn$insert(lookup_var)
# Disconnect
rm(mongo_conn)
library(tidyverse);library(readxl)
library(tigris);library(sf);library(janitor)
library(tidycensus);library(viridis);library(tmap)
library(RPostgres);library(RPostgreSQL);library(DBI)
library(geojsonsf);library(mongolite)
# Set tigris option to TRUE for Census geometries
# to load with ACS data call in first section of script
options(tigris_use_cache = TRUE)
# Load API keys and database connection information
source("secret.R", local = TRUE)
census_api_key(api_key_census)
# Set working directory to current path
setwd(here::here())
# Connect to MongoDB database/collection
mongo_conn <- mongo_connect(collection_name = "acs_variable_lu",
database_name = "ADA-PARC")
# Write to database and add spatial index
mongo_conn$insert(lookup_var)
# Disconnect
rm(mongo_conn)
# Connect to MongoDB database/collection
mongo_conn <- mongo_connect(collection_name = "acs_C21007",
database_name = "ADA-PARC")
# Write to database and add spatial index
mongo_conn$insert(block_groups_pwd)
# Disconnect
rm(mongo_conn)
View(block_groups_sf)
install.packages("nodbi")
---
title: "ADA-PARC"
runtime: shiny
output:
flexdashboard::flex_dashboard:
orientation: rows
vertical_layout: scroll
theme: flatly
---
```{r setup, include=FALSE}
# ====================
# Setup
# ====================
# Packages
library(tidyverse); library(readxl); library(openxlsx); library(summarytools); library(janitor);
library(sf); library(urbnmapr); library(leaflet); library(leaflet.extras);
library(htmltools); library(shiny); library(shinyWidgets); library(flexdashboard);
library(colourpicker); library(DT); library(highcharter);
library(scales); library(hrbrthemes); library(ggthemes); library(extrafont); library(plotly)
library(mongolite)
# Must install urbnmapr via GitHUb if is not already installed
# install.packages("devtools")
# devtools::install_github("UrbanInstitute/urbnmapr")
# Load API keys and database connection information
source("secret.R", local = TRUE)
```
Home
============================================================================
Sidebar {.sidebar}
-----------------------------------------------------------------------
<br>
#### How to Navigate<br>this Website
<br>
Use the **National** tab to examine the status of people with disabilities at the national and state level.
Use the **By Metro** tab to investigate transit accessibility to jobs and housing by county or city.
Use the **Download** tab to get the raw data powering this dashboard and as well as pre-formatted fact sheets a specific area of interest.
Use the **Accessibility** tab to set color palettes for the visualizations in this dashboard.
<br>
Application author:
[Sean Connelly](https://sean-connelly.github.io/) and [Ethan Jantz]()
[Voorhees Center](https://voorheescenter.uic.edu/)
Row
-----------------------------------------------------------------------
###
<br>
Welcome to the ADA-PARC website. The ADA-PARC is a collaborative research project of 7 Americans with Disabilities Act (ADA) Regional Centers.
<br>
#### Purpose of ADA-PARC
The ADA-PARC research has four purposes:
1. **To look at participation disparities** experienced by people with disabilities post ADA & Olmstead
2. **To identify & examine key environmental factors** contributing to these disparities
3. **To benchmark participation disparities and highlight promising practices** at state & city levels
4. **To action-plan strategies for dissemination and utilization of findings** to be used by ADA Centers and others in community capacity building & systems change initiatives
<br>
#### The Work of the ADA-PARC
The ADA-PARC has research teams focused on Community Living, Community Participation & Work/Economic Participation measures and uses Regional Steering Committees in each of the seven participating regions to gather, review, and choose appropriate data to achieve the project's purposes. The data are mainly from national data sources that have enough statistical power to be relevant on the local level.
The intent of this effort is to use this information to inform:
1. ADA Center technical assistance and resource dissemination, and
2. Community level stakeholders to increase participation opportunities in their communities.
<br>
#### Who is the ADA-PARC
The seven participating ADA-Regional Centers in the ADA-PARC are:
- Region 6 Southwest ADA Center: Lex Frieden, Co-Project Director
- Region 5 Great Lakes ADA Center: Joy Hammel, Co-Project Director, Community Participation data team lead
- Region 9 Pacific ADA Center: Lewis Kraus, Community Living data team lead
- Region 4 Southeast ADA Center: Katie McDonald, Work & Economics data team lead
- Region 8 Rocky Mountain ADA Center: Bob Gattis
- Region 3 Mid-Atlantic ADA Center: Marian Vessels
- Region 10 Great Northwest ADA Center: Kathe Matrone
<br>
#### About this Website
The ADA-PARC website is a collection of public data sets that can help shed light on the status of people with disabilities in local communities. The data includes national, state, county, and city data. In addition to Demographic data describing the population, the three main areas of data to illuminate the status of disability in an area are: Community Living, Community Participation and Work & Economics. Each of the three areas presents data in map form as well as in tabular form. A summary of what is important about the data is presented on each page. The data source is described along with the calculation to arrive at the values used in the tables and maps. Data is first presented by state, and then if available, at county and city level.
Accessibility
To learn about the accessibility features of this website, please see the Accessibility Statement at the bottom of any page.
Demographics {data-navmenu="National" data-icon="fa-user"}
======================================================================
```{r, national import}
# ====================
# Import data
# ====================
# Set database path
db_path <- "February 2020 update 2018 ACS/2.20.20DatabaseACS2018.final.xlsx"
# Demographics
demographics <- read_excel(path = db_path,
sheet = "Demographics",
.name_repair = make_clean_names,
skip = 2) %>%
remove_empty(c("rows", "cols")) %>%
rename("abbrev" = state_abbreviation) %>%
mutate(across(-c(state:city), as.numeric))
# Community Living
community_living <- read_excel(path = db_path,
sheet = "Community Living",
.name_repair = make_clean_names,
skip = 2) %>%
remove_empty(c("rows", "cols")) %>%
mutate(across(-c(state:abbrev), as.numeric))
# Community Participation
community_participation <- read_excel(path = db_path,
sheet = "CommunityParticipation",
.name_repair = make_clean_names,
skip = 3) %>%
remove_empty(c("rows", "cols")) %>%
mutate(across(-c(state:city), as.numeric))
# Work and Economic
work_economic <- read_excel(path = db_path,
sheet = "WorkEconomic",
.name_repair = make_clean_names,
skip = 3) %>%
remove_empty(c("rows", "cols")) %>%
mutate(across(-c(state:city), as.numeric))
# Metro Data
metro_demo_data <- demographics %>%
filter(is.na(city) == FALSE) %>%
mutate(metro_state = paste0(city, ", ", abbrev)) %>%
select(metro_state,
pwd, total_population, everything()) %>%  # This is cleaner than listing out every variable
mutate_if(is.numeric, round, 1)
# Read in spatial data
states_sf <- get_urbn_map(map = "states", sf = TRUE)
```
rm(test)
pull(block_groups_pwd, pwd_est)
block_groups_pwd$pwd_perc_est
percent(block_groups_pwd$pwd_perc_est)
percent(block_groups_pwd$pwd_perc_est,
accuracy = 0.1)
metro_snapshot_block <- mongo_conn$find(query = '{"properties.metro_state" : "Albuquerque, NM" }')
mongo_conn <- mongo_connect(collection_name = "acs_C21007",
database_name = "ADA-PARC")
metro_snapshot_block <- mongo_conn$find(query = '{"properties.metro_state" : "Albuquerque, NM" }')
mongo_conn$find(query = '{"properties.metro_state" : "Albuquerque, NM" }')
mongo_conn$find(query = '{ "properties.metro_state" : "Albuquerque, NM" }')
metro_snapshot_block <- mongo_conn$find(query = '{ "metro_state" : "Albuquerque, NM" }')
# Connect to MongoDB database/collection
mongo_conn <- mongo_connect(collection_name = "acs_C21007",
database_name = "ADA-PARC")
metro_snapshot_block < mongo_conn$find()
rm(metro_snapshot_block)
metro_snapshot_block <- mongo_conn$find()
View(metro_snapshot_block)
View(metro_demo_data)
mongo_conn <- mongo_connect(collection_name = "geo_block_group",
database_name = "ADA-PARC")
temp_geo <- mongo_conn$iterate(query = '{ "properties.metro_state" : "Albuquerque, NM" }')
metro_snapshot_block_sf <- geojsonsf::geojson_sf(temp_geo$json(size = 100000))
rm(mongo_conn)
mongo_conn <- mongo_connect(collection_name = "geo_block_group",
database_name = "ADA-PARC")
temp_geo <- mongo_conn$iterate(query = '{ "properties.metro_state" : "Albuquerque, NM" }')
metro_snapshot_block_sf <- geojsonsf::geojson_sf(temp_geo$json(size = 100000))
install.packages("gghighlight")
library(gghighlight)
View(metro_demo_data)
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability)
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
ggplot(aes(x = total_pop, y = pwd_perc,
label = paste0("Metro: ", metro_state, "<br>",
"PWD" = scales::comma(pwd), "<br>",
"Total Pop." = scales::comma(total_pop), "<br>",
"PWD (%)" = paste0(pwd_perc, "%"))))
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability)
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
ggplot(aes(x = total_pop, y = pwd_perc,
label = paste0("Metro: ", metro_state, "<br>",
"PWD" = scales::comma(pwd), "<br>",
"Total Pop." = scales::comma(total_pop), "<br>",
"PWD (%)" = paste0(pwd_perc, "%")))) +
# gghighlight(metro_state %in% input$metro_snapshot) +
labs(x = "Total Population", y = "PWD (%)") +
scale_x_log10(labels = scales::comma()) +
scale_y_continuous(labels = paste0(scale = 1, accuracy = 1))
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
ggplot(aes(x = total_pop, y = pwd_perc,
label = paste0("Metro: ", metro_state, "<br>",
"PWD" = scales::comma(pwd), "<br>",
"Total Pop." = scales::comma(total_pop), "<br>",
"PWD (%)" = paste0(pwd_perc, "%")))) +
# gghighlight(metro_state %in% input$metro_snapshot) +
labs(x = "Total Population", y = "PWD (%)")
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
ggplot(aes(x = total_pop, y = pwd_perc,
label = paste0("Metro: ", metro_state, "<br>",
"PWD" = scales::comma(pwd), "<br>",
"Total Pop." = scales::comma(total_pop), "<br>",
"PWD (%)" = paste0(pwd_perc, "%")))) +
# gghighlight(metro_state %in% input$metro_snapshot) +
labs(x = "Total Population", y = "PWD (%)") +
scale_x_log10(labels = scales::comma)
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability)
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
ggplot(aes(x = total_pop, y = pwd_perc,
label = paste0("Metro: ", metro_state, "<br>",
"PWD" = scales::comma(pwd), "<br>",
"Total Pop." = scales::comma(total_pop), "<br>",
"PWD (%)" = paste0(pwd_perc, "%")))) +
geom_point() +
# gghighlight(metro_state %in% input$metro_snapshot) +
labs(x = "Total Population", y = "PWD (%)") +
scale_x_log10(labels = scales::comma) +
scale_y_continuous(labels = paste0(scale = 1, accuracy = 1))
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
ggplot(aes(x = total_pop, y = pwd_perc,
label = paste0("Metro: ", metro_state, "<br>",
"PWD" = scales::comma(pwd), "<br>",
"Total Pop." = scales::comma(total_pop), "<br>",
"PWD (%)" = paste0(pwd_perc, "%")))) +
geom_point() +
# gghighlight(metro_state %in% input$metro_snapshot) +
labs(x = "Total Population", y = "PWD (%)") +
scale_x_log10(labels = scales::comma) +
scale_y_continuous(labels = scales::percent(scale = 1, accuracy = 1))
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
ggplot(aes(x = total_pop, y = pwd_perc,
label = paste0("Metro: ", metro_state, "<br>",
"PWD" = scales::comma(pwd), "<br>",
"Total Pop." = scales::comma(total_pop), "<br>",
"PWD (%)" = paste0(pwd_perc, "%")))) +
# gghighlight(metro_state %in% input$metro_snapshot) +
labs(x = "Total Population", y = "PWD (%)") +
scale_x_log10(labels = scales::comma) +
scale_y_continuous(labels = scales::percent_format(scale = 1, accuracy = 1))
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability)
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
mutate(pwd_perc = coalesce(pwd_perc, round((pwd / total_pop) * 100, 1))
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
mutate(pwd_perc = coalesce(pwd_perc, round((pwd / total_pop) * 100, 1)))
metro_demo_data %>%
select(metro_state,
"pwd" = pwd,
"total_pop" = total_population,
"pwd_perc" = percent_of_total_population_with_a_disability) %>%
mutate(pwd_perc = coalesce(pwd_perc, round((pwd / total_pop) * 100, 1)))
View(metro_demo_data)
View(metro_demo_data)
# ====================
# Setup
# ====================
# Packages
library(tidyverse); library(readxl); library(openxlsx); library(summarytools); library(janitor);
library(sf); library(urbnmapr); library(leaflet); library(leaflet.extras);
library(htmltools); library(shiny); library(shinyWidgets); library(flexdashboard);
library(colourpicker); library(DT); library(gghighlight); library(highcharter);
install.packages("gghighlight")
# ====================
# Setup
# ====================
# Packages
library(tidyverse); library(readxl); library(openxlsx); library(summarytools); library(janitor);
library(sf); library(urbnmapr); library(leaflet); library(leaflet.extras);
library(htmltools); library(shiny); library(shinyWidgets); library(flexdashboard);
library(colourpicker); library(DT); library(gghighlight); library(highcharter);
library(scales); library(hrbrthemes); library(ggthemes);
library(extrafont); library(plotly)
library(mongolite)
# Must install urbnmapr via GitHUb if is not already installed
# install.packages("devtools")
# devtools::install_github("UrbanInstitute/urbnmapr")
# Load API keys and database connection information
source("secret.R", local = TRUE)
library(tidyverse);library(readxl)
library(tigris);library(sf);library(janitor)
library(tidycensus);library(viridis);library(tmap)
library(RPostgres);library(RPostgreSQL);library(DBI)
library(geojsonsf);library(mongolite)
# Set tigris option to TRUE for Census geometries
# to load with ACS data call in first section of script
options(tigris_use_cache = TRUE)
# Set working directory to current path
setwd(here::here())
# Import list of existing places used in analysis
db_path <- "February 2020 update 2018 ACS/2.20.20DatabaseACS2018.final.xlsx"
base_existing <- read_excel(path = db_path,
sheet = "Demographics",
.name_repair = make_clean_names,
skip = 2) %>%
remove_empty(c("rows", "cols")) %>%
filter(!is.na(city), city != "United States")  %>%
rename("abbrev" = state_abbreviation) %>%
mutate(across(-c(state:city), as.numeric),
"metro_state" = paste0(city, ", ", abbrev)) %>%
mutate(metro_state = case_when(metro_state == "Arlington Heights Village, IL" ~
"Arlington Heights, IL",
metro_state == "Hazel Crest Village, IL" ~
"Hazel Crest, IL",
metro_state == "Indianapolis, IN" ~
"Indianapolis city (balance), IN",
metro_state == "Naperville City, IL" ~
"Naperville, IL",
metro_state == "Nashville-Davidson, TN" ~
"Nashville-Davidson metropolitan government (balance), TN",
TRUE ~ metro_state)) %>%
select(state, abbrev, city, metro_state, everything())
View(base_existing)
# Get Census designated places
places <- map_df(.x = base_existing %>% pull(abbrev) %>% unique(),
.f = ~(tigris::places(state = .x, cb = TRUE, class = "sf") %>%
rename("place_fips" = GEOID, "place_name" = NAME) %>%
mutate("state" = .x,
"metro_state" = paste0(place_name, ", ", state)) %>%
select(place_fips, place_name, state, metro_state, everything()))) %>%
semi_join(., base_existing, by = "metro_state")
?tigris::places
library(tidycensus)
map_data <- function(data) {
data %>%
left_join(states_sf, ., by = c("state_name", "state_abbv")) %>%
st_transform(4326)
}
render_map <- function(data, selected) {
map <- data %>%
mutate(map_focus = !!sym(selected)) %>%
leaflet() %>%
clearShapes() %>%
addResetMapButton() %>%
addPolygons(stroke = TRUE, color = "#444444", weight = 1, smoothFactor = 0,
fillColor = ~create_palette(data, selected)(map_focus),
fillOpacity = 1,
popup = ~paste(state_name, " (", state_abbv, ")", "<br>",
percent(map_focus,
scale = 1, accuracy = 0.1)),
layerId = ~state_name) %>%
addLegend(position = "topright", pal = create_palette(data, selected),
values = ~map_focus,
labFormat =  function(type, cuts, p) {
n = length(cuts)
paste0(as.numeric(cuts)[-n], " &ndash; ", as.numeric(cuts)[-1])
},
title = paste0("PWD (%),<br>", input$demo_gen_type))
map
}
create_palette <- function(data, selected) {
colorQuantile(palette = input$access_map_palette,
domain = pull(data, !!sym(selected)),
n = 4)
}
